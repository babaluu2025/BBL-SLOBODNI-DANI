<!DOCTYPE html>
<html lang="sr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kalendar zaposlenih</title>
  <link rel="manifest" href="manifest.json" />
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
      overflow-x: hidden;
    }

    header {
      background-color: #1976d2;
      color: white;
      text-align: center;
      padding: 10px;
      font-size: 20px;
    }

    /* Glavni deo sada ima padding ispod trake */
    #main {
      padding-bottom: 80px;
      overflow-y: auto;
    }

    .employee-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      padding: 15px;
    }

    .employee {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      padding: 15px;
      text-align: center;
      font-weight: bold;
      user-select: none;
      transition: 0.2s;
    }

    .employee:active {
      background-color: #e0e0e0;
    }

    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      padding: 10px;
    }

    .day {
      background: white;
      text-align: center;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: 0.2s;
    }

    .day:hover {
      background-color: #dfe6fd;
    }

    .free-day {
      background-color: #a5d6a7 !important;
    }

    .vacation-day {
      background-color: #90caf9 !important;
    }

    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: #1976d2;
      display: flex;
      justify-content: space-around;
      padding: 12px;
      z-index: 100;
    }

    .bottom-nav button {
      background-color: white;
      color: #1976d2;
      border: none;
      border-radius: 8px;
      padding: 10px 15px;
      font-size: 15px;
      font-weight: bold;
      cursor: pointer;
      flex: 1;
      margin: 0 5px;
      transition: 0.2s;
    }

    .bottom-nav button:active {
      background-color: #bbdefb;
    }

    .manager-view {
      padding: 15px;
      padding-bottom: 100px; /* prostor za traku */
      background: #fafafa;
    }

    .employee-report {
      background: white;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 15px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    h2 {
      margin: 0 0 5px 0;
      color: #333;
    }

    .section-title {
      font-weight: bold;
      margin-top: 8px;
      color: #555;
    }

    .back-btn {
      display: block;
      margin: 20px auto 80px auto;
      padding: 10px 20px;
      background: #1976d2;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>Kalendar zaposlenih</header>

  <div id="main"></div>

  <div class="bottom-nav">
    <button id="freeDaysBtn">Slobodni dani</button>
    <button id="vacationBtn">Godišnji odmor</button>
    <button id="managerBtn">Menadžer</button>
  </div>

  <script>
    const main = document.getElementById("main");
    let mode = null;
    let selectedEmployee = null;
    let employees = Array.from({ length: 50 }, (_, i) => ({
      name: `Zaposleni ${i + 1}`,
      freeDays: [],
      vacations: []
    }));

    if (localStorage.getItem("employees")) {
      employees = JSON.parse(localStorage.getItem("employees"));
    }

    function saveData() {
      localStorage.setItem("employees", JSON.stringify(employees));
    }

    function renderHome() {
      main.innerHTML = "";
      const grid = document.createElement("div");
      grid.className = "employee-grid";

      employees.forEach((emp, index) => {
        const div = document.createElement("div");
        div.className = "employee";
        div.textContent = emp.name;

        div.addEventListener("click", () => openCalendar(index));

        let pressTimer;
        div.addEventListener("mousedown", () => {
          pressTimer = setTimeout(() => renameEmployee(index), 800);
        });
        div.addEventListener("mouseup", () => clearTimeout(pressTimer));
        div.addEventListener("touchstart", () => {
          pressTimer = setTimeout(() => renameEmployee(index), 800);
        });
        div.addEventListener("touchend", () => clearTimeout(pressTimer));

        grid.appendChild(div);
      });

      main.appendChild(grid);
    }

    function renameEmployee(index) {
      const newName = prompt("Unesi novo ime zaposlenog:", employees[index].name);
      if (newName && newName.trim() !== "") {
        employees[index].name = newName.trim();
        saveData();
        renderHome();
      }
    }

    function openCalendar(index) {
      selectedEmployee = index;
      renderCalendar(index);
    }

    function renderCalendar(index) {
      const emp = employees[index];
      main.innerHTML = `<h2 style="text-align:center;margin:10px;">${emp.name}</h2>`;
      const cal = document.createElement("div");
      cal.className = "calendar";

      for (let m = 0; m < 12; m++) {
        for (let d = 1; d <= 31; d++) {
          const date = new Date(2025, m, d);
          if (date.getMonth() !== m) continue;

          const div = document.createElement("div");
          div.className = "day";
          div.textContent = `${d}.${m + 1}.`;

          const dateKey = `${d}.${m + 1}.2025`;
          if (emp.freeDays.includes(dateKey)) div.classList.add("free-day");
          if (emp.vacations.includes(dateKey)) div.classList.add("vacation-day");

          div.addEventListener("click", () => toggleDay(dateKey, div));
          cal.appendChild(div);
        }
      }
      main.appendChild(cal);
    }

    function toggleDay(dateKey, div) {
      const emp = employees[selectedEmployee];
      if (!mode) return;

      if (mode === "free") {
        const idx = emp.freeDays.indexOf(dateKey);
        if (idx >= 0) emp.freeDays.splice(idx, 1);
        else emp.freeDays.push(dateKey);
      }

      if (mode === "vacation") {
        const idx = emp.vacations.indexOf(dateKey);
        if (idx >= 0) emp.vacations.splice(idx, 1);
        else emp.vacations.push(dateKey);
      }

      saveData();
      renderCalendar(selectedEmployee);
    }

    function renderManager() {
      main.innerHTML = `<header style="background:#1976d2;color:white;padding:10px;text-align:center;">Menadžer</header>`;
      const manager = document.createElement("div");
      manager.className = "manager-view";

      employees.forEach(emp => {
        const report = document.createElement("div");
        report.className = "employee-report";

        const name = document.createElement("h2");
        name.textContent = emp.name;
        report.appendChild(name);

        const freeCount = emp.freeDays.length;
        const vacCount = emp.vacations.length;

        const p = document.createElement("p");
        p.textContent = `Slobodni: ${freeCount} | Godišnji: ${vacCount}`;
        report.appendChild(p);

        manager.appendChild(report);
      });

      const backBtn = document.createElement("button");
      backBtn.textContent = "Nazad";
      backBtn.className = "back-btn";
      backBtn.onclick = renderHome;
      manager.appendChild(backBtn);

      main.appendChild(manager);
    }

    document.getElementById("freeDaysBtn").onclick = () => { mode = "free"; alert("Režim: Slobodni dani (zelena)"); };
    document.getElementById("vacationBtn").onclick = () => { mode = "vacation"; alert("Režim: Godišnji odmor (plava)"); };
    document.getElementById("managerBtn").onclick = renderManager;

    renderHome();
  </script>
</body>
</html>
